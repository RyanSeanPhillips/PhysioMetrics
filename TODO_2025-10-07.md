# TODO List - October 7, 2025

## HIGH PRIORITY: Sniffing Bout Export and Consolidation

### 1. Add Sniffing Bout Data to CSV Export
**Goal**: Export sniffing bout annotations just like eupnea regions are currently exported

**Tasks**:
- [ ] Review current eupnea export implementation in `core/export.py`
- [ ] Add sniffing bout data columns to CSV export:
  - `sniff_bout_start` (time in seconds)
  - `sniff_bout_end` (time in seconds)
  - `sniff_bout_duration` (seconds)
  - `sniff_bout_count` (number of bouts in sweep)
- [ ] Ensure sniffing data is pulled from `state.sniff_regions_by_sweep` (or similar storage)
- [ ] Test export with files containing sniffing annotations
- [ ] Verify CSV format matches eupnea export structure

**Files to modify**:
- `core/export.py` (main export logic)
- Possibly `main.py` (if export trigger needs updating)

**Estimated time**: 2-3 hours

---

### 2. Add Sniffing Consolidation to Curation Tab
**Goal**: Consolidate sniffing bout data across multiple files, similar to eupnea consolidation

**Tasks**:
- [ ] Review current eupnea consolidation implementation
- [ ] Add sniffing bout consolidation logic:
  - Aggregate sniffing bouts across all selected files
  - Calculate time-binned sniffing bout metrics:
    - Bout frequency (bouts per second in each time bin)
    - Total bout duration per time bin
    - Mean bout duration per time bin
- [ ] Add sniffing output to consolidated CSV:
  - Separate columns or separate CSV file for sniffing data
  - Time-aligned with eupnea and breathing metrics
- [ ] Update consolidation dialog to show sniffing processing status
- [ ] Test with multi-file datasets

**Files to modify**:
- `main.py` (consolidation dialog and logic, around lines 2400+)
- Possibly create `core/sniff_consolidation.py` if complex

**Estimated time**: 3-4 hours

---

### 3. Ensure Backward Compatibility
**Goal**: Handle older data files that don't have sniffing annotations without errors

**Tasks**:
- [ ] Add safe checks for missing sniffing data:
  - Check if `sniff_regions_by_sweep` exists before accessing
  - Default to empty list/dict if sniffing data is missing
  - Don't fail export or consolidation if sniffing data absent
- [ ] Test with old CSV files (pre-sniffing feature)
- [ ] Test with new CSV files (with sniffing data)
- [ ] Ensure graceful degradation:
  - Export still works, just omits sniffing columns if not present
  - Consolidation still works, shows N/A or empty for sniffing metrics
- [ ] Add version checking or data structure validation if needed

**Files to modify**:
- `core/export.py` (add existence checks)
- `main.py` (consolidation logic)
- Possibly `core/state.py` (initialize sniffing storage safely)

**Estimated time**: 1-2 hours

---

## MEDIUM PRIORITY

### 4. MainPlot Resizing (Deferred from Oct 6)
**Status**: Attempted multiple approaches, all failed or caused issues

**Possible future approaches**:
- Use QSplitter instead of layouts
- Investigate Qt Designer's Form Layout with size policies
- Ask Qt community for best practices on mixed absolute/layout positioning
- Accept limitation and document that window should be maximized for best experience

**Decision**: Defer until more pressing features completed

---

## LOW PRIORITY

### 5. Documentation Updates
- [ ] Update `CLAUDE.md` with recent spectral analysis changes
- [ ] Document sniffing export/consolidation once implemented
- [ ] Update user-facing documentation if any exists

---

## Notes
- **Sniffing bout storage**: Verify where sniffing regions are currently stored in `state` object
  - Check `main.py` for sniffing bout marking logic
  - Confirm data structure: likely list of (start, end) tuples per sweep
- **Eupnea reference**: Use eupnea implementation as template for all sniffing work
  - Eupnea export: search for "eupnea" in `core/export.py`
  - Eupnea consolidation: search for "eupnea" in `main.py` consolidation section
- **Testing strategy**:
  1. First test export with small dataset
  2. Then test consolidation with 2-3 files
  3. Finally test backward compatibility with old data

**Total estimated time for HIGH PRIORITY items**: 6-9 hours
